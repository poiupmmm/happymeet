"use strict";(()=>{var e={};e.id=254,e.ids=[254],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},64012:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>x,originalPathname:()=>I,patchFetch:()=>q,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>j});var s={};r.r(s),r.d(s,{DELETE:()=>p,GET:()=>c,PATCH:()=>l});var n=r(95419),i=r(69108),a=r(99678),o=r(78070),m=r(49605),u=r(3205),d=r(3214);async function c(e,{params:t}){try{let e=await d._.comment.findUnique({where:{id:t.commentId},include:{user:{select:{id:!0,name:!0,image:!0}}}});if(!e)return o.Z.json({message:"评论不存在"},{status:404});if(e.eventId!==t.id)return o.Z.json({message:"评论不属于此活动"},{status:400});return o.Z.json(e)}catch(e){return console.error("获取评论详情错误:",e),o.Z.json({message:"获取评论详情失败"},{status:500})}}async function l(e,{params:t}){try{let r=await (0,m.getServerSession)(u.L);if(!r)return o.Z.json({message:"未授权"},{status:401});let s=await d._.comment.findUnique({where:{id:t.commentId}});if(!s)return o.Z.json({message:"评论不存在"},{status:404});if(s.eventId!==t.id)return o.Z.json({message:"评论不属于此活动"},{status:400});if(s.userId!==r.user.id)return o.Z.json({message:"无权更新此评论"},{status:403});let{content:n}=await e.json();if(!n||0===n.trim().length)return o.Z.json({message:"评论内容不能为空"},{status:400});if(n.length>1e3)return o.Z.json({message:"评论内容不能超过1000字"},{status:400});let i=await d._.comment.update({where:{id:t.commentId},data:{content:n},include:{user:{select:{id:!0,name:!0,image:!0}}}});return o.Z.json(i)}catch(e){return console.error("更新评论错误:",e),o.Z.json({message:"更新评论失败"},{status:500})}}async function p(e,{params:t}){try{let e=await (0,m.getServerSession)(u.L);if(!e)return o.Z.json({message:"未授权"},{status:401});let r=await d._.comment.findUnique({where:{id:t.commentId}});if(!r)return o.Z.json({message:"评论不存在"},{status:404});if(r.eventId!==t.id)return o.Z.json({message:"评论不属于此活动"},{status:400});let s=await d._.event.findUnique({where:{id:t.id}});if(!s)return o.Z.json({message:"活动不存在"},{status:404});if(r.userId!==e.user.id&&s.creatorId!==e.user.id)return o.Z.json({message:"无权删除此评论"},{status:403});return await d._.comment.delete({where:{id:t.commentId}}),o.Z.json({message:"评论已删除"},{status:200})}catch(e){return console.error("删除评论错误:",e),o.Z.json({message:"删除评论失败"},{status:500})}}let g=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/events/[id]/comments/[commentId]/route",pathname:"/api/events/[id]/comments/[commentId]",filename:"route",bundlePath:"app/api/events/[id]/comments/[commentId]/route"},resolvedPagePath:"C:\\Users\\NK645TY\\OneDrive - EY CHINA\\桌面\\CURSOR\\happymeet\\app\\api\\events\\[id]\\comments\\[commentId]\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:v,serverHooks:f,headerHooks:x,staticGenerationBailout:j}=g,I="/api/events/[id]/comments/[commentId]/route";function q(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:v})}},3205:(e,t,r)=>{r.d(t,{L:()=>i});var s=r(86485),n=r(63164);let i={providers:[(0,s.Z)({name:"credentials",credentials:{email:{label:"邮箱",type:"text"},password:{label:"密码",type:"password"}},async authorize(e){if(!e?.email)return null;let t=n.rC.find(t=>t.email===e.email);return t?{id:t.id,name:t.name,email:t.email,image:t.image}:null}})],pages:{signIn:"/login"},session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET||"default-secret-for-development"}},63164:(e,t,r)=>{r.d(t,{U3:()=>n,Xx:()=>i,rC:()=>s});let s=[{id:"1",name:"张三",email:"zhangsan@example.com",image:"https://randomuser.me/api/portraits/men/1.jpg"},{id:"2",name:"李四",email:"lisi@example.com",image:"https://randomuser.me/api/portraits/women/2.jpg"}],n=[{id:"1",title:"周末爬山活动",description:"一起去爬山，呼吸新鲜空气，欣赏美丽风景。",startTime:"2023-09-30T08:00:00",endTime:"2023-09-30T17:00:00",location:"黄山",latitude:30.1299,longitude:118.1651,maxMembers:20,price:0,creatorId:"1",groupId:"1"},{id:"2",title:"读书分享会",description:"分享你最近读过的好书，交流读书心得。",startTime:"2023-10-05T19:00:00",endTime:"2023-10-05T21:00:00",location:"线上",latitude:0,longitude:0,maxMembers:50,price:0,creatorId:"2",groupId:"2"}],i=[{id:"1",name:"户外探险俱乐部",description:"喜欢户外活动、探险和挑战的朋友们聚集地",category:"户外",location:"北京",latitude:39.9042,longitude:116.4074,creatorId:"1"},{id:"2",name:"读书会",description:"每周一起阅读和讨论好书",category:"教育",location:"上海",latitude:31.2304,longitude:121.4737,creatorId:"2"}]},3214:(e,t,r)=>{r.d(t,{_:()=>i});class s{constructor(){this.user=n("user"),this.group=n("group"),this.event=n("event"),this.comment=n("comment"),this.membership=n("membership"),this.eventParticipant=n("eventParticipant")}}function n(e){return{findUnique:()=>Promise.resolve(null),findMany:()=>Promise.resolve([]),create:()=>Promise.resolve({}),update:()=>Promise.resolve({}),delete:()=>Promise.resolve({}),count:()=>Promise.resolve(0)}}let i=new s}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,206,255],()=>r(64012));module.exports=s})();