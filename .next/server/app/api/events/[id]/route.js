"use strict";(()=>{var e={};e.id=7,e.ids=[7],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},54878:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>h,originalPathname:()=>j,patchFetch:()=>b,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>v,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>y});var n={};r.r(n),r.d(n,{DELETE:()=>p,GET:()=>d,PATCH:()=>c});var a=r(95419),s=r(69108),i=r(99678),o=r(78070),u=r(4118),l=r(3214);async function d(e,{params:t}){try{let e=await l._.event.findUnique({where:{id:t.id},include:{creator:{select:{id:!0,name:!0,image:!0}},group:{select:{id:!0,name:!0}},members:{include:{user:{select:{id:!0,name:!0,image:!0}}}},_count:{select:{members:!0,comments:!0}}}});if(!e)return o.Z.json({message:"活动不存在"},{status:404});return o.Z.json(e)}catch(e){return console.error("获取活动详情错误:",e),o.Z.json({message:"获取活动详情失败"},{status:500})}}async function c(e,{params:t}){try{let r=await (0,u.auth)();if(!r)return o.Z.json({message:"未授权"},{status:401});let n=await l._.event.findUnique({where:{id:t.id}});if(!n)return o.Z.json({message:"活动不存在"},{status:404});if(n.creatorId!==r.user.id)return o.Z.json({message:"无权更新此活动"},{status:403});let{title:a,description:s,startTime:i,endTime:d,location:c,latitude:p,longitude:m,maxMembers:f,price:g}=await e.json();if(!a||!s||!i||!d||!c||!f)return o.Z.json({message:"请填写所有必填字段"},{status:400});let v=new Date(i),h=new Date(d);if(h<=v)return o.Z.json({message:"结束时间必须晚于开始时间"},{status:400});let y=new Date;if(n.startTime<=y&&(v.getTime()!==n.startTime.getTime()||h.getTime()!==n.endTime.getTime()))return o.Z.json({message:"活动已开始，无法修改时间"},{status:400});let j=await l._.event.update({where:{id:t.id},data:{title:a,description:s,startTime:v,endTime:h,location:c,latitude:parseFloat(p)||n.latitude,longitude:parseFloat(m)||n.longitude,maxMembers:parseInt(f)||n.maxMembers,price:void 0!==parseFloat(g)?parseFloat(g):n.price}});return o.Z.json(j)}catch(e){return console.error("更新活动错误:",e),o.Z.json({message:"更新活动失败"},{status:500})}}async function p(e,{params:t}){try{let e=await (0,u.auth)();if(!e)return o.Z.json({message:"未授权"},{status:401});let r=await l._.event.findUnique({where:{id:t.id}});if(!r)return o.Z.json({message:"活动不存在"},{status:404});if(r.creatorId!==e.user.id)return o.Z.json({message:"无权删除此活动"},{status:403});return await l._.$transaction([l._.eventMember.deleteMany({where:{eventId:t.id}}),l._.comment.deleteMany({where:{eventId:t.id}}),l._.event.delete({where:{id:t.id}})]),o.Z.json({message:"活动已删除"},{status:200})}catch(e){return console.error("删除活动错误:",e),o.Z.json({message:"删除活动失败"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/events/[id]/route",pathname:"/api/events/[id]",filename:"route",bundlePath:"app/api/events/[id]/route"},resolvedPagePath:"C:\\Users\\NK645TY\\OneDrive - EY CHINA\\桌面\\CURSOR\\happymeet\\app\\api\\events\\[id]\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:v,headerHooks:h,staticGenerationBailout:y}=m,j="/api/events/[id]/route";function b(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:g})}},4118:(e,t,r)=>{r.r(t),r.d(t,{GET:()=>o,POST:()=>o,auth:()=>u});var n=r(81355),a=r.n(n),s=r(3205),i=r(49605);let o=a()(s.L),u=i.getServerSession.bind(null,s.L)},3205:(e,t,r)=>{r.d(t,{L:()=>s});var n=r(86485),a=r(63164);let s={providers:[(0,n.Z)({name:"credentials",credentials:{email:{label:"邮箱",type:"text"},password:{label:"密码",type:"password"}},async authorize(e){if(!e?.email)return null;let t=a.rC.find(t=>t.email===e.email);return t?{id:t.id,name:t.name,email:t.email,image:t.image}:null}})],pages:{signIn:"/login"},session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET||"default-secret-for-development"}},63164:(e,t,r)=>{r.d(t,{U3:()=>a,Xx:()=>s,rC:()=>n});let n=[{id:"1",name:"张三",email:"zhangsan@example.com",image:"https://randomuser.me/api/portraits/men/1.jpg"},{id:"2",name:"李四",email:"lisi@example.com",image:"https://randomuser.me/api/portraits/women/2.jpg"}],a=[{id:"1",title:"周末爬山活动",description:"一起去爬山，呼吸新鲜空气，欣赏美丽风景。",startTime:"2023-09-30T08:00:00",endTime:"2023-09-30T17:00:00",location:"黄山",latitude:30.1299,longitude:118.1651,maxMembers:20,price:0,creatorId:"1",groupId:"1"},{id:"2",title:"读书分享会",description:"分享你最近读过的好书，交流读书心得。",startTime:"2023-10-05T19:00:00",endTime:"2023-10-05T21:00:00",location:"线上",latitude:0,longitude:0,maxMembers:50,price:0,creatorId:"2",groupId:"2"}],s=[{id:"1",name:"户外探险俱乐部",description:"喜欢户外活动、探险和挑战的朋友们聚集地",category:"户外",location:"北京",latitude:39.9042,longitude:116.4074,creatorId:"1"},{id:"2",name:"读书会",description:"每周一起阅读和讨论好书",category:"教育",location:"上海",latitude:31.2304,longitude:121.4737,creatorId:"2"}]},3214:(e,t,r)=>{r.d(t,{_:()=>s});class n{constructor(){this.user=a("user"),this.group=a("group"),this.event=a("event"),this.comment=a("comment"),this.membership=a("membership"),this.eventParticipant=a("eventParticipant")}}function a(e){return{findUnique:()=>Promise.resolve(null),findMany:()=>Promise.resolve([]),create:()=>Promise.resolve({}),update:()=>Promise.resolve({}),delete:()=>Promise.resolve({}),count:()=>Promise.resolve(0)}}let s=new n},77381:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},81355:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return s.default}});var a=r(77381);Object.keys(a).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e))&&(e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))});var s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&({}).hasOwnProperty.call(e,s)){var o=a?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(n,s,o):n[s]=e[s]}return n.default=e,r&&r.set(e,n),n}(r(49605));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}Object.keys(s).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e))&&(e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[638,206,255],()=>r(54878));module.exports=n})();