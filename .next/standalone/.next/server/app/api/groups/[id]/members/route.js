"use strict";(()=>{var e={};e.id=808,e.ids=[808],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},39943:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>y,originalPathname:()=>j,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>b});var s={};t.r(s),t.d(s,{DELETE:()=>c,GET:()=>d,PATCH:()=>p});var i=t(95419),n=t(69108),a=t(99678),o=t(78070),u=t(4118),l=t(3214);async function d(e,{params:r}){try{if(!await l._.group.findUnique({where:{id:r.id}}))return o.Z.json({message:"小组不存在"},{status:404});let e=await l._.groupMember.findMany({where:{groupId:r.id},include:{user:{select:{id:!0,name:!0,email:!0,image:!0}}},orderBy:[{role:"asc"},{joinedAt:"asc"}]});return o.Z.json({members:e,count:e.length})}catch(e){return console.error("获取小组成员错误:",e),o.Z.json({message:"获取小组成员失败"},{status:500})}}async function p(e,{params:r}){try{let t=await (0,u.auth)();if(!t)return o.Z.json({message:"未授权"},{status:401});if(!await l._.groupMember.findFirst({where:{groupId:r.id,userId:t.user.id,role:"ADMIN"}}))return o.Z.json({message:"无权执行此操作"},{status:403});let{userId:s,role:i}=await e.json();if(!s||!i)return o.Z.json({message:"缺少必要参数"},{status:400});let n=await l._.groupMember.findFirst({where:{groupId:r.id,userId:s}});if(!n)return o.Z.json({message:"该成员不存在"},{status:404});if(n.userId===t.user.id)return o.Z.json({message:"不能修改自己的角色"},{status:400});let a=await l._.groupMember.update({where:{id:n.id},data:{role:i},include:{user:{select:{id:!0,name:!0,email:!0,image:!0}}}});return o.Z.json(a)}catch(e){return console.error("更新成员角色错误:",e),o.Z.json({message:"更新成员角色失败"},{status:500})}}async function c(e,{params:r}){try{let t=await (0,u.auth)(),s=new URL(e.url).searchParams.get("userId");if(!t)return o.Z.json({message:"未授权"},{status:401});if(!s)return o.Z.json({message:"缺少用户ID参数"},{status:400});let i=s===t.user.id;if(!i){if(!await l._.groupMember.findFirst({where:{groupId:r.id,userId:t.user.id,role:"ADMIN"}}))return o.Z.json({message:"无权执行此操作"},{status:403});let e=await l._.groupMember.findFirst({where:{groupId:r.id,userId:s}});if(e?.role==="ADMIN")return o.Z.json({message:"不能移除管理员"},{status:400})}return await l._.groupMember.deleteMany({where:{groupId:r.id,userId:s}}),o.Z.json({message:i?"已离开小组":"已移除成员"},{status:200})}catch(e){return console.error("移除成员错误:",e),o.Z.json({message:"移除成员失败"},{status:500})}}let m=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/groups/[id]/members/route",pathname:"/api/groups/[id]/members",filename:"route",bundlePath:"app/api/groups/[id]/members/route"},resolvedPagePath:"C:\\Users\\NK645TY\\OneDrive - EY CHINA\\桌面\\CURSOR\\happymeet\\app\\api\\groups\\[id]\\members\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:h,headerHooks:y,staticGenerationBailout:b}=m,j="/api/groups/[id]/members/route";function v(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},4118:(e,r,t)=>{t.r(r),t.d(r,{GET:()=>o,POST:()=>o,auth:()=>u});var s=t(81355),i=t.n(s),n=t(3205),a=t(49605);let o=i()(n.L),u=a.getServerSession.bind(null,n.L)},3205:(e,r,t)=>{t.d(r,{L:()=>n});var s=t(86485),i=t(63164);let n={providers:[(0,s.Z)({name:"credentials",credentials:{email:{label:"邮箱",type:"text"},password:{label:"密码",type:"password"}},async authorize(e){if(!e?.email)return null;let r=i.rC.find(r=>r.email===e.email);return r?{id:r.id,name:r.name,email:r.email,image:r.image}:null}})],pages:{signIn:"/login"},session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET||"default-secret-for-development"}},63164:(e,r,t)=>{t.d(r,{U3:()=>i,Xx:()=>n,rC:()=>s});let s=[{id:"1",name:"张三",email:"zhangsan@example.com",image:"https://randomuser.me/api/portraits/men/1.jpg"},{id:"2",name:"李四",email:"lisi@example.com",image:"https://randomuser.me/api/portraits/women/2.jpg"}],i=[{id:"1",title:"周末爬山活动",description:"一起去爬山，呼吸新鲜空气，欣赏美丽风景。",startTime:"2023-09-30T08:00:00",endTime:"2023-09-30T17:00:00",location:"黄山",latitude:30.1299,longitude:118.1651,maxMembers:20,price:0,creatorId:"1",groupId:"1"},{id:"2",title:"读书分享会",description:"分享你最近读过的好书，交流读书心得。",startTime:"2023-10-05T19:00:00",endTime:"2023-10-05T21:00:00",location:"线上",latitude:0,longitude:0,maxMembers:50,price:0,creatorId:"2",groupId:"2"}],n=[{id:"1",name:"户外探险俱乐部",description:"喜欢户外活动、探险和挑战的朋友们聚集地",category:"户外",location:"北京",latitude:39.9042,longitude:116.4074,creatorId:"1"},{id:"2",name:"读书会",description:"每周一起阅读和讨论好书",category:"教育",location:"上海",latitude:31.2304,longitude:121.4737,creatorId:"2"}]},3214:(e,r,t)=>{t.d(r,{_:()=>n});class s{constructor(){this.user=i("user"),this.group=i("group"),this.event=i("event"),this.comment=i("comment"),this.membership=i("membership"),this.eventParticipant=i("eventParticipant")}}function i(e){return{findUnique:()=>Promise.resolve(null),findMany:()=>Promise.resolve([]),create:()=>Promise.resolve({}),update:()=>Promise.resolve({}),delete:()=>Promise.resolve({}),count:()=>Promise.resolve(0)}}let n=new s},77381:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0})},81355:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0});var s={};Object.defineProperty(r,"default",{enumerable:!0,get:function(){return n.default}});var i=t(77381);Object.keys(i).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(s,e))&&(e in r&&r[e]===i[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}}))});var n=function(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=a(r);if(t&&t.has(e))return t.get(e);var s={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&({}).hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(s,n,o):s[n]=e[n]}return s.default=e,t&&t.set(e,s),s}(t(49605));function a(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(a=function(e){return e?t:r})(e)}Object.keys(n).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(s,e))&&(e in r&&r[e]===n[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}}))})}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,206,255],()=>t(39943));module.exports=s})();