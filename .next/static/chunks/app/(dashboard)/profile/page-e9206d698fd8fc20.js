(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[688],{2576:function(e,t,n){Promise.resolve().then(n.bind(n,6868))},6868:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var s=n(7437),i=n(2265),r=n(4033),o=n(2749),a=n(5754),l=n(5179);let c=["旅行","美食","运动","阅读","音乐","电影","艺术","科技","摄影","游戏","户外","健身","舞蹈","烹饪","语言","手工"];function d(){var e;let{data:t,status:n,update:d}=(0,o.useSession)(),u=(0,r.useRouter)(),[m,f]=(0,i.useState)(!0),[x,b]=(0,i.useState)(!1),[h,p]=(0,i.useState)({type:"",text:""}),[g,v]=(0,i.useState)({name:"",bio:"",location:"",interests:[]});async function y(e){try{let t=await fetch("/api/users/".concat(e));if(t.ok){let e=await t.json();v({name:e.name||"",bio:e.bio||"",location:e.location||"",interests:e.interests||[]})}}catch(e){console.error("获取用户资料失败:",e)}finally{f(!1)}}(0,i.useEffect)(()=>{var e;"unauthenticated"===n?u.push("/login"):"authenticated"===n&&(null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.id)&&y(t.user.id)},[n,u,null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.id]);let j=e=>{let{name:t,value:n}=e.target;v(e=>({...e,[t]:n}))},N=e=>{v(t=>{let n=[...t.interests];return n.includes(e)?{...t,interests:n.filter(t=>t!==e)}:{...t,interests:[...n,e]}})};async function w(e){e.preventDefault(),b(!0),p({type:"",text:""});try{var n,s;let e=await fetch("/api/users/".concat(null==t?void 0:null===(n=t.user)||void 0===n?void 0:n.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)});if(e.ok)p({type:"success",text:"个人资料已更新！"}),g.name!==(null==t?void 0:null===(s=t.user)||void 0===s?void 0:s.name)&&await d({name:g.name});else{let t=await e.json();p({type:"error",text:t.message||"更新失败，请稍后重试"})}}catch(e){console.error("更新用户资料失败:",e),p({type:"error",text:"更新失败，请稍后重试"})}finally{b(!1)}}return m?(0,s.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,s.jsx)("p",{className:"text-lg",children:"加载中..."})}):(0,s.jsxs)("div",{className:"mx-auto max-w-3xl px-4 py-8 sm:px-6 lg:px-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"个人资料"}),(0,s.jsx)("p",{className:"mt-2 text-gray-600",children:"更新您的个人信息和兴趣爱好"})]}),(0,s.jsxs)("form",{onSubmit:w,className:"space-y-6",children:[(0,s.jsx)("div",{className:"rounded-lg border bg-white p-6 shadow-sm",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium",children:"姓名"}),(0,s.jsx)(l.I,{id:"name",name:"name",type:"text",required:!0,value:g.name,onChange:j,className:"mt-1"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"bio",className:"block text-sm font-medium",children:"个人简介"}),(0,s.jsx)("textarea",{id:"bio",name:"bio",rows:3,value:g.bio||"",onChange:j,className:"mt-1 block w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"location",className:"block text-sm font-medium",children:"所在地"}),(0,s.jsx)(l.I,{id:"location",name:"location",type:"text",value:g.location||"",onChange:j,className:"mt-1"})]})]})}),(0,s.jsxs)("div",{className:"rounded-lg border bg-white p-6 shadow-sm",children:[(0,s.jsx)("h2",{className:"mb-4 text-lg font-semibold",children:"兴趣标签"}),(0,s.jsx)("p",{className:"mb-4 text-sm text-gray-600",children:"选择您感兴趣的话题，这将帮助我们为您推荐相关小组和活动"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:c.map(e=>(0,s.jsx)("button",{type:"button",className:"rounded-full px-3 py-1 text-sm ".concat(g.interests.includes(e)?"bg-primary text-white":"bg-gray-100 text-gray-800 hover:bg-gray-200"),onClick:()=>N(e),children:e},e))})]}),h.text&&(0,s.jsx)("div",{className:"rounded-md p-4 ".concat("success"===h.type?"bg-green-50 text-green-800":"bg-red-50 text-red-800"),children:h.text}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)(a.z,{type:"submit",disabled:x,children:x?"保存中...":"保存资料"})})]})]})}},5754:function(e,t,n){"use strict";n.d(t,{z:function(){return o}});var s=n(7437),i=n(2265),r=n(1657);let o=(0,i.forwardRef)((e,t)=>{let{className:n,variant:i="default",size:o="default",...a}=e;return(0,s.jsx)("button",{className:(0,r.cn)("inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{"bg-primary text-primary-foreground hover:bg-primary/90":"default"===i,"border border-input bg-background hover:bg-accent hover:text-accent-foreground":"outline"===i,"hover:bg-accent hover:text-accent-foreground":"ghost"===i,"text-primary underline-offset-4 hover:underline":"link"===i,"h-10 px-4 py-2":"default"===o,"h-9 rounded-md px-3":"sm"===o,"h-11 rounded-md px-8":"lg"===o},n),ref:t,...a})});o.displayName="Button"},5179:function(e,t,n){"use strict";n.d(t,{I:function(){return o}});var s=n(7437),i=n(2265),r=n(1657);let o=i.forwardRef((e,t)=>{let{className:n,type:i,...o}=e;return(0,s.jsx)("input",{type:i,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...o})});o.displayName="Input"},1657:function(e,t,n){"use strict";n.d(t,{cn:function(){return r}});var s=n(7042),i=n(3986);function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,i.m)((0,s.W)(t))}}},function(e){e.O(0,[604,873,971,938,744],function(){return e(e.s=2576)}),_N_E=e.O()}]);