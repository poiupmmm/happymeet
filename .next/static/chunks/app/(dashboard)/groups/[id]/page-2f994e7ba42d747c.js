(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[605],{3890:function(e,s,t){Promise.resolve().then(t.bind(t,4070))},4070:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return x}});var n=t(7437),r=t(2265),i=t(4033),a=t(2749),l=t(1396),c=t.n(l),d=t(5754);function o(e){let{role:s}=e;switch(s){case"ADMIN":return(0,n.jsx)("span",{className:"rounded-full bg-primary px-2 py-0.5 text-xs font-medium text-white",children:"管理员"});case"MODERATOR":return(0,n.jsx)("span",{className:"rounded-full bg-amber-500 px-2 py-0.5 text-xs font-medium text-white",children:"协管员"});default:return null}}function m(e){let{event:s}=e,t=new Date(s.startTime).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return(0,n.jsx)("div",{className:"rounded-lg border bg-white shadow-sm",children:(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:(0,n.jsx)(c(),{href:"/events/".concat(s.id),className:"hover:text-primary",children:s.title})}),(0,n.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:t}),(0,n.jsx)("p",{className:"mt-2 text-sm text-gray-600 line-clamp-2",children:s.description}),(0,n.jsxs)("div",{className:"mt-3 flex items-center justify-between",children:[(0,n.jsxs)("span",{className:"text-sm text-gray-500",children:[s.location," \xb7 ",s._count.members," 人参加"]}),(0,n.jsx)(c(),{href:"/events/".concat(s.id),children:(0,n.jsx)(d.z,{size:"sm",variant:"outline",children:"查看详情"})})]})]})})}function u(e){let{members:s,isAdmin:t}=e;return(0,n.jsxs)("div",{className:"rounded-lg border bg-white p-4 shadow-sm",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:"小组成员"}),(0,n.jsxs)("span",{className:"text-sm text-gray-500",children:[s.length," 人"]})]}),(0,n.jsx)("div",{className:"mt-4 space-y-3",children:s.map(e=>{var s;return(0,n.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-100 pb-3",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-200 text-center leading-8",children:(null===(s=e.user.name)||void 0===s?void 0:s.charAt(0))||"U"}),(0,n.jsxs)("div",{className:"ml-3",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"font-medium",children:e.user.name}),(0,n.jsx)("div",{className:"ml-2",children:(0,n.jsx)(o,{role:e.role})})]}),(0,n.jsxs)("p",{className:"text-xs text-gray-500",children:["加入于 ",new Date(e.joinedAt).toLocaleDateString()]})]})]}),t&&"ADMIN"!==e.role&&(0,n.jsx)(d.z,{size:"sm",variant:"outline",children:"管理"})]},e.id)})})]})}function x(e){let{params:s}=e,{data:t,status:l}=(0,a.useSession)(),o=(0,i.useRouter)(),[x,h]=(0,r.useState)(!0),[f,j]=(0,r.useState)(null),[p,g]=(0,r.useState)(null),[v,N]=(0,r.useState)([]),[b,y]=(0,r.useState)([]),[w,z]=(0,r.useState)(!1);async function k(){try{let[e,n,r]=await Promise.all([fetch("/api/groups/".concat(s.id)),fetch("/api/groups/".concat(s.id,"/events")),fetch("/api/groups/".concat(s.id,"/members"))]);if(e.ok&&n.ok&&r.ok){let s=await e.json(),i=await n.json(),a=await r.json();j(s),N(i.events),y(a.members);let l=a.members.find(e=>{var s;return e.user.id===(null==t?void 0:null===(s=t.user)||void 0===s?void 0:s.id)});g(l)}else console.error("获取小组数据失败"),o.push("/groups")}catch(e){console.error("获取小组数据错误:",e)}finally{h(!1)}}async function S(){var e;if(null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.id){z(!0);try{let e=await fetch("/api/groups/".concat(s.id,"/join"),{method:"POST"});if(e.ok){let s=await e.json();g(s),k()}else console.error("加入小组失败")}catch(e){console.error("加入小组错误:",e)}finally{z(!1)}}}if((0,r.useEffect)(()=>{"authenticated"===l?k():"unauthenticated"===l&&o.push("/login")},[l,s.id]),x)return(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,n.jsx)("p",{className:"text-lg",children:"加载中..."})});if(!f)return(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,n.jsx)("p",{className:"text-lg",children:"找不到此小组"})});let D=(null==p?void 0:p.role)==="ADMIN",A=!!p;return(0,n.jsx)("div",{className:"mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8",children:(0,n.jsxs)("div",{className:"mb-8 grid grid-cols-1 gap-8 lg:grid-cols-3",children:[(0,n.jsxs)("div",{className:"lg:col-span-2",children:[(0,n.jsxs)("div",{className:"rounded-lg border bg-white p-6 shadow-sm",children:[(0,n.jsxs)("div",{className:"flex flex-col justify-between sm:flex-row sm:items-start",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold",children:f.name}),(0,n.jsxs)("div",{className:"mt-2 flex items-center gap-3",children:[(0,n.jsx)("span",{className:"rounded-full bg-gray-100 px-3 py-1 text-sm text-gray-700",children:f.category}),(0,n.jsx)("span",{className:"text-sm text-gray-500",children:f.location})]})]}),A?D?(0,n.jsx)(c(),{href:"/groups/".concat(s.id,"/edit"),children:(0,n.jsx)(d.z,{variant:"outline",className:"mt-4 sm:mt-0",children:"管理小组"})}):(0,n.jsx)(d.z,{variant:"outline",className:"mt-4 sm:mt-0",disabled:!0,children:"已加入"}):(0,n.jsx)(d.z,{onClick:S,disabled:w,className:"mt-4 sm:mt-0",children:w?"加入中...":"加入小组"})]}),(0,n.jsx)("p",{className:"mt-6 whitespace-pre-line text-gray-700",children:f.description}),(0,n.jsxs)("div",{className:"mt-6 text-sm text-gray-500",children:[(0,n.jsxs)("p",{children:["创建于 ",new Date(f.createdAt).toLocaleDateString()]}),(0,n.jsxs)("p",{children:["创建者: ",f.creator.name]})]})]}),(0,n.jsxs)("div",{className:"mt-8",children:[(0,n.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold",children:"小组活动"}),A&&(0,n.jsx)(c(),{href:"/events/create?groupId=".concat(s.id),children:(0,n.jsx)(d.z,{size:"sm",children:"发起活动"})})]}),0===v.length?(0,n.jsxs)("div",{className:"rounded-lg border bg-white p-8 text-center shadow-sm",children:[(0,n.jsx)("h3",{className:"text-lg font-medium",children:"暂无活动"}),(0,n.jsx)("p",{className:"mt-2 text-gray-500",children:"这个小组还没有举办任何活动"}),A&&(0,n.jsx)("div",{className:"mt-6",children:(0,n.jsx)(c(),{href:"/events/create?groupId=".concat(s.id),children:(0,n.jsx)(d.z,{children:"发起活动"})})})]}):(0,n.jsx)("div",{className:"space-y-4",children:v.map(e=>(0,n.jsx)(m,{event:e},e.id))})]})]}),(0,n.jsx)("div",{children:(0,n.jsx)(u,{members:b,isAdmin:D})})]})})}},5754:function(e,s,t){"use strict";t.d(s,{z:function(){return a}});var n=t(7437),r=t(2265),i=t(1657);let a=(0,r.forwardRef)((e,s)=>{let{className:t,variant:r="default",size:a="default",...l}=e;return(0,n.jsx)("button",{className:(0,i.cn)("inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{"bg-primary text-primary-foreground hover:bg-primary/90":"default"===r,"border border-input bg-background hover:bg-accent hover:text-accent-foreground":"outline"===r,"hover:bg-accent hover:text-accent-foreground":"ghost"===r,"text-primary underline-offset-4 hover:underline":"link"===r,"h-10 px-4 py-2":"default"===a,"h-9 rounded-md px-3":"sm"===a,"h-11 rounded-md px-8":"lg"===a},t),ref:s,...l})});a.displayName="Button"},1657:function(e,s,t){"use strict";t.d(s,{cn:function(){return i}});var n=t(7042),r=t(3986);function i(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,r.m)((0,n.W)(s))}},1396:function(e,s,t){e.exports=t(5250)}},function(e){e.O(0,[604,873,250,971,938,744],function(){return e(e.s=3890)}),_N_E=e.O()}]);